---
- name: Ensure apt is up to date
  apt: update_cache=yes
  become: true
  become_method: sudo
  tags: install

- name: Ensure packages are upgraded
  apt: upgrade=full
  become: true
  become_method: sudo
  tags: install

- name: Ensure the following packages are installed
  apt: name={{ item }}
  with_items:
    - python-dev
    - python-pip
    - python-virtualenv
    - libjpeg-dev
    - libfreetype6-dev
    - libtiff5-dev
    - zlib1g-dev
    - git
    - libxml2-dev
    - libxslt-dev
    - libyaml-dev
    - supervisor
    - openjdk-7-jre-headless
    - redis-server
  become: true
  become_method: sudo
  tags: install

- name: Install redis python library
  pip: name=redis
  become: true
  become_method: sudo
  tags: install

- name: Download node.js LTS
  get_url: url=https://nodejs.org/dist/v4.5.0/node-v4.5.0.tar.gz dest={{ base_path }}

- name: Uncompress the node.js LTS package
  unarchive: src={{ base_path }}/node-v4.5.0.tar.gz dest={{ base_path }} copy=no

- name: Configure node.js LTS
  command: chdir={{ base_path }}/node-v4.5.0 ./configure

- name: Compile node.js LTS
  command: chdir={{ base_path }}/node-v4.5.0 make

- name: Install node.js LTS
  command: chdir={{ base_path }}/node-v4.5.0 make install
  become: true
  become_method: sudo

- name: Install lessc
  npm: name=less global=yes
  become: true
  become_method: sudo
